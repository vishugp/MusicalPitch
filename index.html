<!doctype html>
<html>
<head>
	<title>Pitch Detector - Indian Classical Music</title>

	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<script src="https://surikov.github.io/webaudiofontdata/npm/dist/WebAudioFontPlayer.js"></script>

	<style>
		:root {
			--space-xs: 4px;
			--space-sm: 8px;
			--space-md: 12px;
			--space-lg: 18px;
			--primary: rgb(32, 32, 142);
		}

		* {
			margin: 0;
			padding: 0;
			box-sizing: border-box;
		}

		body {
			font-family: "Inter", sans-serif;
			background-color: #eef6ff;
			color: #333;
			padding: var(--space-md);
		}

		.container {
			max-width: 1200px;
			margin: 0 auto;
		}

		/* Header */
		.header {
			text-align: center;
			margin-bottom: var(--space-md);
		}

		.header h2 {
			font-size: 1.5rem;
			font-weight: 700;
			color: var(--primary);
			margin-bottom: var(--space-xs);
		}

		.header p {
			font-size: 0.85rem;
			color: #555;
		}

		/* Layout */
		.main-content {
			display: grid;
			grid-template-columns: 1fr 2fr;
			grid-auto-rows: minmax(180px, auto);
			gap: var(--space-md);
		}

		/* Cards */
		.card {
			background: white;
			border-radius: 14px;
			padding: var(--space-md);
			box-shadow: 0 6px 18px rgba(0,0,0,0.12);
		}

		.card h3 {
			font-size: 0.95rem;
			font-weight: 600;
			color: var(--primary);
			margin-bottom: var(--space-sm);
			border-bottom: 1px solid #eee;
			padding-bottom: var(--space-xs);
		}

		/* Buttons */
		.button-group {
			display: flex;
			flex-wrap: wrap;
			gap: var(--space-xs);
			margin-bottom: var(--space-sm);
		}

		button {
			padding: 6px 12px;
			font-size: 0.7rem;
			font-weight: 500;
			border: none;
			border-radius: 6px;
			cursor: pointer;
			font-family: "Inter", sans-serif;
		}

		.btn-primary {
			background: var(--primary);
			color: white;
		}

		.btn-secondary {
			background: #f0f0f0;
			color: #333;
		}

		/* Sa calibration */
		.sa-frequency-container {
			background: #f8f9fa;
			padding: var(--space-sm);
			border-radius: 8px;
		}

		.sa-frequency-container label {
			font-size: 0.75rem;
			font-weight: 600;
			margin-right: var(--space-xs);
		}

		.sa-frequency-container input {
			width: 90px;
			padding: 5px 6px;
			font-size: 0.7rem;
			border-radius: 5px;
			border: 2px solid #e0e0e0;
		}

		#calibration_status {
			margin-top: var(--space-sm);
			font-size: 0.7rem;
			font-weight: 500;
		}

		/* Pitch Detector */
		#detector {
			text-align: center;
			padding: var(--space-md);
			border-radius: 10px;
		}

		#detector.confident {
			background: linear-gradient(135deg, #d6e9ff 0%, #b3d9ff 100%);
		}

		#detector.vague {
			background: #f5f5f5;
		}

		.pitch {
			font-size: 0.95rem;
			font-weight: 600;
			margin-bottom: var(--space-xs);
			color: var(--primary);
		}

		#indian_note {
			font-size: 2.4rem;
			font-weight: 700;
			color: var(--primary);
			margin-bottom: var(--space-xs);
		}

		#note {
			font-size: 2rem;
			font-weight: 700;
			margin-bottom: var(--space-xs);
		}

		#detune {
			font-size: 0.85rem;
			font-weight: 500;
		}

		#detune_amt {
			color: #d63031;
		}

		#flat, #sharp {
			display: none;
		}

		.flat #flat,
		.sharp #sharp {
			display: inline;
		}

		/* Graph */
		#frequency_graph {
			width: 100%;
			height: 180px;
			background: #fafafa;
			border-radius: 6px;
			border: 1px solid #e0e0e0;
		}

		.graph-label {
			text-align: center;
			font-size: 0.65rem;
			color: #666;
			margin-top: var(--space-xs);
		}

		/* Responsive */
		@media (max-width: 768px) {
			.main-content {
				grid-template-columns: 1fr;
			}
		}
	</style>
</head>

<body>
	<div class="container">

		<div class="header">
			<h2>üéµ Pitch Detector</h2>
			<p>Indian Classical Music ‚Äì Real-time Pitch Detection</p>
		</div>

		<div class="main-content">

			<div class="card">
				<h3>Controls</h3>

				<div class="button-group">
					<button class="btn-primary" onclick="startPitchDetect()">üé§ Start Mic</button>
					<button class="btn-secondary" onclick="toggleOscillator()">üîä Shruti Box</button>
					<button class="btn-secondary" onclick="document.getElementById('audio_file_input').click()">üéµ Load File</button>
					<input type="file" id="audio_file_input" accept="audio/*" hidden onchange="handleAudioFileSelect(event)">
					<button class="btn-secondary" id="play_audio_btn" onclick="togglePlayback()" disabled>‚ñ∂Ô∏è Play</button>
				</div>

				<div class="sa-frequency-container">
					<label>Sa (Hz)</label>
					<input type="number" id="sa_frequency" min="100" max="500" step="0.1" value="240">
					<button class="btn-primary" id="calibrate_sa_button">Calibrate</button>
					<div id="calibration_status" hidden></div>
				</div>
			</div>

			<div class="card">
				<h3>üéº Raga Analysis</h3>
				<div id="note_analysis">
					<p style="color:#666;font-style:italic;font-size:0.75rem;">
						Start singing to analyze note usage‚Ä¶
					</p>
				</div>
			</div>

			<div class="card">
				<h3>Current Pitch</h3>
				<div id="detector" class="vague">
					<div class="pitch"><span id="pitch">--</span> Hz</div>
					<div id="indian_note">--</div>
					<div id="note">--</div>
					<div id="detune">
						<span id="detune_amt">--</span>
						<span id="flat"> cents ‚ô≠</span>
						<span id="sharp"> cents ‚ôØ</span>
					</div>
				</div>
			</div>

			<div class="card">
				<h3>Frequency Graph</h3>
				<canvas id="frequency_graph"></canvas>
				<div class="graph-label">
					Frequency over time (Hz)
				</div>
			</div>

		</div>
	</div>

	<script src="js/pitchdetect.js"></script>
</body>
</html>
