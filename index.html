<!doctype html>
<html>
	<head>
		<title>Pitch Detector - Indian Classical Music</title>
		<link href='https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap' rel='stylesheet'>
		<script src="https://surikov.github.io/webaudiofontdata/npm/dist/WebAudioFontPlayer.js"></script>
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}
			
			body { 
				font-family: 'Inter', sans-serif;
				background-color: #eef6ff;
				min-height: 100vh;
				padding: 20px;
				color: #333;
			}
			
			.container {
				max-width: 1800px;
				margin: 0 auto;
			}
			
			.header {
				text-align: center;
				color: rgb(32, 32, 142);
				margin-bottom: 30px;
			}
			
			.header h1 {
				font-size: 2.5em;
				font-weight: 700;
				margin-bottom: 10px;
			}
			
			.header p {
				font-size: 1.1em;
				color: #333;
			}
			
			.main-content {
				display: grid;
				grid-template-columns: 1fr 2fr;
				gap: 20px;
				margin-bottom: 20px;
			}
			
			.card {
				background: white;
				border-radius: 27px;
				padding: 25px;
				box-shadow: 0 10px 30px rgba(0,0,0,0.2);
				backdrop-filter: blur(10px);
			}
			
			.controls-card {
				grid-column: 1 / -1;
			}
			
			.raga-analysis-card {
				grid-column: 1 / -1;
				background: linear-gradient(135deg, #ffffff 0%, #f8f9ff 100%);
				border: 2px solid rgba(32, 32, 142, 0.1);
			}
			
			.note-analysis-container {
				padding: 20px;
				min-height: 180px;
				background: rgba(255, 255, 255, 0.6);
				border-radius: 12px;
				margin-top: 10px;
			}
			
			.analysis-placeholder {
				color: #666;
				font-style: italic;
				text-align: center;
				padding: 40px 20px;
				font-size: 1.05em;
			}
			
			.note-card {
				text-align: center;
				padding: 18px 20px;
				background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
				border-radius: 12px;
				border: 2px solid;
				min-width: 100px;
				flex: 0 0 auto;
				transition: all 0.3s ease;
				box-shadow: 0 2px 8px rgba(0,0,0,0.08);
			}
			
			.note-card:hover {
				transform: translateY(-3px);
				box-shadow: 0 4px 12px rgba(0,0,0,0.15);
			}
			
			.note-label {
				font-size: 0.95em;
				font-weight: 600;
				color: #333;
				margin-bottom: 8px;
				letter-spacing: 0.5px;
			}
			
			.note-variant {
				font-size: 1.6em;
				font-weight: 700;
				margin: 8px 0;
			}
			
			.note-percentage {
				font-size: 0.8em;
				color: #666;
				margin-top: 6px;
				font-weight: 500;
			}
			
			.analysis-footer {
				margin-top: 20px;
				padding: 12px 16px;
				background: linear-gradient(135deg, #e8f4f8 0%, #d6e9f5 100%);
				border-radius: 8px;
				font-size: 0.9em;
				color: #555;
				text-align: center;
				border: 1px solid rgba(32, 32, 142, 0.1);
			}
			
			.card h2 {
				font-size: 1.3em;
				font-weight: 600;
				margin-bottom: 20px;
				color: rgb(32, 32, 142);
				border-bottom: 2px solid #f0f0f0;
				padding-bottom: 10px;
			}
			
			.button-group {
				display: flex;
				gap: 10px;
				flex-wrap: wrap;
				margin-bottom: 20px;
			}
			
			button {
				padding: 12px 24px;
				font-size: 14px;
				font-weight: 500;
				border: none;
				border-radius: 8px;
				cursor: pointer;
				transition: all 0.3s ease;
				font-family: 'Inter', sans-serif;
			}
			
			.btn-primary {
				background-color: rgb(32, 32, 142);
				color: white;
			}
			
			.btn-primary:hover {
				background-color: rgb(24, 24, 120);
				transform: translateY(-2px);
				box-shadow: 0 5px 15px rgba(32, 32, 142, 0.4);
			}
			
			.btn-secondary {
				background: #f0f0f0;
				color: #333;
			}
			
			.btn-secondary:hover {
				background: #e0e0e0;
				transform: translateY(-2px);
			}
			
			.sa-frequency-container {
				background: #f8f9fa;
				padding: 20px;
				border-radius: 12px;
				margin-bottom: 15px;
			}
			
			.sa-frequency-container label {
				font-weight: 600;
				margin-right: 10px;
				color: #555;
			}
			
			.sa-frequency-container input {
				font-size: 14px;
				padding: 8px 12px;
				border: 2px solid #e0e0e0;
				border-radius: 6px;
				width: 120px;
				margin-right: 15px;
				transition: border-color 0.3s;
			}
			
			.sa-frequency-container input:focus {
				outline: none;
				border-color: #667eea;
			}
			
			#calibration_status {
				margin-top: 15px;
				padding: 12px;
				border-radius: 8px;
				font-weight: 500;
			}
			
			#detector {
				text-align: center;
				padding: 30px;
				border-radius: 12px;
				transition: all 0.3s ease;
			}
			
			#detector.confident {
				background: linear-gradient(135deg, #d6e9ff 0%, #b3d9ff 100%);
			}
			
			#detector.vague {
				background: #f5f5f5;
			}
			
			.pitch {
				font-size: 2em;
				font-weight: 600;
				color: rgb(32, 32, 142);
				margin-bottom: 15px;
			}
			
			#note {
				font-size: 64px;
				font-weight: 700;
				color: #333;
				line-height: 1;
				margin: 20px 0;
			}
			
			.indian-note {
				margin: 20px 0;
			}
			
			#indian_note {
				font-size: 88px;
				font-weight: 700;
				color: rgb(32, 32, 142);
				text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
			}
			
			#detune {
				font-size: 1.2em;
				margin-top: 15px;
				font-weight: 500;
			}
			
			#detune_amt {
				color: #d63031;
			}
			
			.flat #flat, .sharp #sharp {
				display: inline;
			}
			
			#flat, #sharp {
				display: none;
			}
			
			.graph-container {
				position: relative;
			}
			
			#frequency_graph {
				width: 100%;
				height: 300px;
				background: #fafafa;
				border-radius: 8px;
				border: 1px solid #e0e0e0;
			}
			
			.graph-label {
				text-align: center;
				margin-top: 10px;
				color: #666;
				font-size: 0.9em;
				font-weight: 500;
			}
			
			@media (max-width: 1024px) {
				.main-content {
					grid-template-columns: 1fr;
				}
				
				.controls-card > div {
					grid-template-columns: 1fr !important;
				}
				
				#note {
					font-size: 80px;
				}
				
				#indian_note {
					font-size: 48px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>ğŸµ Pitch Detector</h1>
				<p>Indian Classical Music - Real-time Pitch Detection</p>
			</div>
			
			<div class="main-content">
				<div class="card controls-card">
					<h2>Controls</h2>
					<div class="button-group">
						<button class="btn-primary" onclick="startPitchDetect();">ğŸ¤ Start Microphone</button>
						<button class="btn-secondary" onclick="document.getElementById('audio_file_input').click();">ğŸµ Load Audio File</button>
						<input type="file" id="audio_file_input" accept="audio/*" style="display: none;" onchange="handleAudioFileSelect(event)">
						<button class="btn-secondary" id="play_audio_btn" onclick="togglePlayback()" disabled>â–¶ï¸ Play Audio</button>
						<button class="btn-secondary" id="shruti_box_btn" onclick="toggleOscillator()">ğŸ”Š Shruti Box</button>
					</div>
					
					<div class="sa-frequency-container">
						<label for="sa_frequency">Sa Frequency (Hz):</label>
						<input type="number" id="sa_frequency" min="100" max="500" step="0.1" value="240">
						<button id="calibrate_sa_button" class="btn-primary" style="padding: 8px 20px;">ğŸ¯ Calibrate Sa</button>
						<div id="calibration_status" style="display: none; margin-top: 15px; padding: 12px; border-radius: 8px; font-weight: 500;"></div>
					</div>
				</div>
				
				<div class="card raga-analysis-card">
					<h2>ğŸ¼ Raga Analysis - Sargam Notes</h2>
					<div id="note_analysis" class="note-analysis-container">
						<p class="analysis-placeholder">Start singing to analyze which note variants are being used...</p>
					</div>
				</div>
				
				<div class="card">
					<h2>Current Pitch</h2>
					<div id="detector" class="vague">
						<div class="pitch"><span id="pitch">--</span> Hz</div>
						<div class="indian-note"><span id="indian_note">--</span></div>
						<div class="note"><span id="note">--</span></div>
						<div id="detune">
							<span id="detune_amt">--</span>
							<span id="flat"> cents &#9837;</span>
							<span id="sharp"> cents &#9839;</span>
						</div>
					</div>
				</div>
				
				<div class="card graph-container">
					<h2>Frequency Graph</h2>
					<canvas id="frequency_graph" width="600" height="300"></canvas>
					<div class="graph-label">Frequency over time (Hz) - Colored bands show Carnatic note ranges (Â±50 cents) for lower, middle, and upper octaves</div>
				</div>
			</div>
		</div>

		<script src="js/pitchdetect.js"></script>

		<script type="text/javascript">
			var _gaq = _gaq || [];
			_gaq.push(['_setAccount', 'UA-35593052-1']);
			_gaq.push(['_trackPageview']);

			(function() {
				var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
				ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
				var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
			})();
		</script>
	</body>
</html>
